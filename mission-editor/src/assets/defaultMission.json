{
  "id": "whispering_corridors",
  "title": "Whispering Corridors",
  "start_room_id": "palace_hall",
  "version": 1,
  "rooms": [
    {
      "id": "palace_hall",
      "name": "Abandoned Palace Hall",
      "art": "palace_hall_bg.png",
      "music": "dusty_strings.ogg",
      "exits": [{ "to": "side_corridor", "label": "Side Corridor" }],
      "auto_nodes": ["mission_intro", "wounded_scout", "collapsed_corridor"],
      "max_visible_nodes": 3
    },
    {
      "id": "side_corridor",
      "name": "Side Corridor",
      "art": "side_corridor.png",
      "music": "hollow_wind.ogg",
      "exits": [{ "to": "palace_hall", "label": "Back" }],
      "auto_nodes": ["guards_patrol", "to_vault_antechamber"],
      "max_visible_nodes": 3
    }
  ],
  "nodes": [
    {
      "id": "mission_intro",
      "type": "scene",
      "room_id": "palace_hall",
      "title": "Arrival",
      "text": "Dust swirls in a shaft of light as you step into the hall...",
      "auto_fire": true,
      "repeatable": false,
      "priority": 10,
      "entry_conditions": [],
      "choices": [{ "label": "Continue", "outcomes": [{ "noop": true }] }]
    },
    {
      "id": "wounded_scout",
      "type": "npc",
      "room_id": "palace_hall",
      "title": "Wounded Scout",
      "text": "A scout slumps against a pillar...",
      "repeatable": false,
      "priority": 5,
      "entry_conditions": [{ "flag_not_set": "scout_helped" }],
      "choices": [
        {
          "label": "Offer food",
          "requirements": [{ "has_item_tag": "food" }],
          "outcomes": [
            { "set_flag": "scout_helped" },
            { "grant_info": "vault_hint_A" },
            { "reveal_node": "secret_shortcut" }
          ]
        },
        { "label": "Move on", "outcomes": [{ "noop": true }] }
      ]
    },
    {
      "id": "collapsed_corridor",
      "type": "lock",
      "room_id": "palace_hall",
      "title": "Collapsed Corridor",
      "text": "Rubble blocks the way.",
      "repeatable": true,
      "priority": 4,
      "entry_conditions": [],
      "choices": [
        {
          "label": "Climb (STR check)",
          "skill_check": { "stat": "STR", "dc": 10 },
          "success_outcomes": [{ "move_room": "side_corridor" }],
          "fail_outcomes": [{ "apply_status": { "wound": 1 } }]
        },
        {
          "label": "Use rope",
          "requirements": [{ "has_item_tag": "rope" }],
          "outcomes": [{ "move_room": "side_corridor" }]
        }
      ]
    },
    {
      "id": "guards_patrol",
      "type": "battle",
      "room_id": "side_corridor",
      "title": "Palace Guards",
      "text": "A patrol rounds the corner.",
      "battle_id": "palace_guards_v1",
      "repeatable": false,
      "priority": 6,
      "entry_conditions": [],
      "on_victory": [{ "reveal_node": "vault_loot" }, { "grant_xp": 25 }],
      "on_defeat": [{ "apply_status": { "wound": 2 } }, { "end_mission": { "failed": true } }]
    },
    {
      "id": "to_vault_antechamber",
      "type": "transition",
      "room_id": "side_corridor",
      "title": "Descend the stairs",
      "text": "A stairwell drops into darkness.",
      "repeatable": true,
      "priority": 2,
      "entry_conditions": [],
      "choices": [
        {
          "label": "Proceed",
          "outcomes": [
            { "move_room": "vault_antechamber" },
            { "play_scene_fx": "door_heavy_open" }
          ]
        }
      ]
    },
    {
      "id": "vault_loot",
      "type": "loot",
      "room_id": "side_corridor",
      "title": "Guard Satchel",
      "text": "You recover a satchel.",
      "repeatable": false,
      "priority": 3,
      "entry_conditions": [],
      "choices": [
        {
          "label": "Collect",
          "outcomes": [
            { "grant_item": "healing_draught" },
            { "grant_card": { "tag": "weapon.common" } }
          ]
        }
      ]
    },
    {
      "id": "end_success",
      "type": "end",
      "room_id": "side_corridor",
      "title": "Exit",
      "text": "You slip away into the night.",
      "end_mission": { "success": true }
    }
  ],
  "battle_templates": [
    {
      "id": "palace_guards_v1",
      "enemies": ["guard", "guard_sergeant"],
      "initiative": "SPD",
      "rules": { "max_turns": 20 },
      "loot_table_id": "guards_common"
    }
  ],
  "loot_tables": [
    {
      "id": "guards_common",
      "entries": [
        { "pick": "card", "tag": "weapon.common", "weight": 60 },
        { "pick": "card", "tag": "equipment.common", "weight": 40 }
      ]
    }
  ]
}
